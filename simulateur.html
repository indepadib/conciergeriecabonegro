<!-- SIMULATEUR CABO NEGRO -->
<section id="simulateur" class="section-accent" style="padding:64px 16px">
  <div class="container reveal">
    <h2 style="font-size:clamp(1.8rem,3.6vw,2.4rem);margin-bottom:8px">Simulateur de prix – Conciergerie Cabo Negro</h2>
    <p style="opacity:.9;max-width:860px">Estimez un tarif de nuitée et un revenu mensuel selon le type de bien, la saison et la proximité plage/golf. Les valeurs sont indicatives et s’alignent sur les fourchettes marché actuelles.</p>

    <div class="card" style="margin-top:24px; padding:20px">
      <form id="ccn-sim" class="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px">
        <label>Type de bien
          <select name="type">
            <option value="studio">Studio / 1 chambre</option>
            <option value="t2">Appartement 2 chambres</option>
            <option value="t3">Appartement 3 chambres</option>
            <option value="villa">Villa</option>
          </select>
        </label>

        <label>Saison
          <select name="saison">
            <option value="basse">Basse (oct–mai)</option>
            <option value="inter">Intermédiaire (juin & sept)</option>
            <option value="haute">Haute (juil–août & fêtes)</option>
          </select>
        </label>

        <label>Distance plage
          <select name="distance">
            <option value="front">Front de mer (1re ligne)</option>
            <option value="10">≤ 10 min à pied</option>
            <option value="20">10–20 min</option>
            <option value="plus">> 20 min</option>
          </select>
        </label>

        <label>Vue
          <select name="vue">
            <option value="mer">Vue mer</option>
            <option value="piscine">Piscine / Jardin</option>
            <option value="aucune">Aucune</option>
          </select>
        </label>

        <label>Résidence
          <select name="res">
            <option value="prestige">Golf / Prestige</option>
            <option value="std" selected>Résidence standard</option>
          </select>
        </label>

        <label>Jour de la semaine
          <select name="jour">
            <option value="dim">Dimanche</option>
            <option value="ven">Vendredi</option>
            <option value="sam">Samedi</option>
            <option value="autre" selected>Autre jour</option>
            <option value="jeu">Jeudi</option>
          </select>
        </label>

        <label>Commission plateforme
          <select name="com">
            <option value="0">Vente directe (0%)</option>
            <option value="0.15" selected>Airbnb/Booking (~15%)</option>
            <option value="0.18">Airbnb/Booking (~18%)</option>
          </select>
        </label>

        <label>Frais ménage/linge (DH)
          <input type="number" name="frais" value="250" min="0" step="10"/>
        </label>

        <label>Taux d’occupation mensuel
          <input type="number" name="occ" value="55" min="0" max="100" step="1"/>
        </label>
      </form>

      <div id="ccn-out" class="card" style="margin-top:18px;padding:18px;background:white">
        <div style="display:flex;gap:12px;align-items:center;margin-bottom:10px">
          <img src="logo/ccn_transparent.png" alt="CCN" style="height:32px">
          <strong>Résultat de simulation</strong>
        </div>
        <div id="ccn-nuitee" style="font-size:1.4rem;margin-bottom:8px">—</div>
        <div id="ccn-month">—</div>
        <small style="opacity:.7">* Prix indiqués en dirhams (MAD). Ajustements selon offres concurrentes et événements locaux.</small>
      </div>
    </div>
  </div>
</section>

<script>
(function(){
  const DH = v => Math.round(v/10)*10; // arrondi 10 DH
  const base = {
    // min et max par type+saison (MAD / nuit)
    studio: { basse:[250,600], inter:[400,900], haute:[700,1500] },
    t2:     { basse:[350,700], inter:[500,1100], haute:[900,1900] },
    t3:     { basse:[450,900], inter:[700,1400], haute:[1200,2400] },
    villa:  { basse:[800,2500], inter:[1200,3500], haute:[1500,6000] }
  };

  const mults = {
    distance: { front:1.20, "10":1.10, "20":1.00, plus:0.90 },
    vue: { mer:1.15, piscine:1.05, aucune:1.00 },
    res: { prestige:1.15, std:1.00 },
    jour: { dim:1.10, ven:1.05, sam:1.05, autre:1.00, jeu:0.95 }
  };

  const $ = s => document.querySelector(s);
  const form = $('#ccn-sim');
  const outN = $('#ccn-nuitee');
  const outM = $('#ccn-month');

  function lerp(a,b,t){ return a+(b-a)*t; }
  function mid([a,b]){ return lerp(a,b,0.55); } // légèrement au-dessus du milieu

  function compute(){
    const f = Object.fromEntries(new FormData(form).entries());
    const b = mid(base[f.type][f.saison]);

    // multiplicateurs cumulés
    let price = b * mults.distance[f.distance] * mults.vue[f.vue] * mults.res[f.res] * mults.jour[f.jour];

    // applique commission (on remonte le prix public pour compenser)
    const commission = parseFloat(f.com||0);
    if(commission>0){ price = price / (1-commission); }

    // nuitee recommandée
    const nuit = DH(price);

    // revenu mensuel estimé (occupation %, frais ménage par séjour moyen 3 nuits)
    const occ = Math.max(0, Math.min(100, parseFloat(f.occ||0)));
    const nuitsMois = 30 * (occ/100);
    const sejours = Math.max(1, nuitsMois/3);
    const frais = parseFloat(f.frais||0) * sejours;

    const revenu = DH(nuitsMois * nuit - frais);

    outN.textContent = `Tarif conseillé : ${nuit.toLocaleString('fr-MA')} DH / nuit`;
    outM.textContent = `Revenu net estimé / mois : ${revenu.toLocaleString('fr-MA')} DH (occ. ${occ}%, frais ${Math.round(frais)} DH)`;

    // petite animation
    outN.style.transition = outM.style.transition = 'transform .25s ease';
    outN.style.transform = outM.style.transform = 'scale(1.02)';
    setTimeout(()=>{ outN.style.transform = outM.style.transform = 'scale(1)'; }, 220);
  }

  form.addEventListener('input', compute);
  document.addEventListener('DOMContentLoaded', compute);
  compute();
})();
</script>
